<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VSCode C++ Web IDE</title>
<style>
    body { margin:0; background:#1e1e2e; color:#ddd; display:flex; height:100vh; overflow:hidden; }
    #sidebar { width:180px; background:#252535; border-right:1px solid #333; padding:10px; box-sizing:border-box; }
    #sidebar button { width:100%; padding:8px; margin-bottom:8px; background:#0078ff; border:none; color:#fff; cursor:pointer; border-radius:4px; }
    #editor { flex:2; }
    #io-panel { width:35%; background:#181825; display:flex; flex-direction:column; }
    #inputArea, #outputArea { flex:1; margin:10px; padding:10px; background:#000; border:1px solid #444; border-radius:6px; color:#0f0; }
    #outputArea { white-space:pre; color:#0ff; }
</style>
</head>

<body>

<div id="sidebar">
    <button onclick="addFile()">üìÑ New File</button>
    <button onclick="runCpp()">‚ñ∂Ô∏è Run</button>
    <div id="fileList"></div>
</div>

<div id="editor"></div>

<div id="io-panel">
    <textarea id="inputArea" placeholder="Nh·∫≠p input cho cin..."></textarea>
    <pre id="outputArea"></pre>
</div>

<!-- Monaco -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

<!-- BriWasm (new CDN) -->
<script src="https://cdn.jsdelivr.net/npm/briwasm@latest/dist/briwasm.js"></script>

<script>
let files = {
    "main.cpp": `#include <iostream>
using namespace std;

int main() {
    string name;
    cin >> name;
    cout << "Hello " << name << "!" << endl;
}`
};

let currentFile = "main.cpp";
let editor;

// üü¶ hi·ªÉn th·ªã danh s√°ch file
function renderFileList() {
    const list = document.getElementById("fileList");
    list.innerHTML = "";
    for (let name in files) {
        let div = document.createElement("div");
        div.style.padding = "6px";
        div.style.cursor = "pointer";
        div.textContent = name;
        div.onclick = () => switchFile(name);
        if (name === currentFile) div.style.background = "#444";
        list.appendChild(div);
    }
}

function switchFile(name) {
    files[currentFile] = editor.getValue();
    currentFile = name;
    editor.setValue(files[name]);
    renderFileList();
}

// üü© ƒë·∫£m b·∫£o global cho onclick
window.addFile = function () {
    const name = prompt("T√™n file:", "utils.h");
    if (!name || files[name]) return;
    files[name] = "// new file";
    renderFileList();
};

require.config({ paths: { "vs": "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs" }});
require(["vs/editor/editor.main"], () => {
    editor = monaco.editor.create(document.getElementById("editor"), {
        value: files[currentFile],
        language: "cpp",
        theme: "vs-dark",
        automaticLayout: true
    });
    renderFileList();
});

// üü¶ ch·∫°y C++ t·ª´ WebAssembly
window.runCpp = async function () {
    files[currentFile] = editor.getValue();
    const input = document.getElementById("inputArea").value;
    const output = document.getElementById("outputArea");

    output.textContent = "‚è≥ Compiling...\n";

    await BriWasm.ready;
    const fileArray = Object.keys(files).map(name => ({
        name, content: files[name]
    }));

    const result = BriWasm.cpp(fileArray, input);

    output.textContent =
        (result.stdout || "") +
        (result.stderr ? "\n‚ùå " + result.stderr : "");
};
</script>

</body>
</html>
